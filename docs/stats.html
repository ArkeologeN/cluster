<html>
  <head>
    <title>Cluster - extensible multi-core server management for nodejs</title>
    <link rel='stylesheet' href='../main.css' />
  </head>
  <body class="subpage">
    <div id="content"><h2>Stats</h2>

<p> The stats plugin collects statistics from the events emitter by the master process, and exposes a <code>stats()</code> <strong>REPL</strong> function.</p>

<h3>Usage</h3>

<p>To utilize simply <code>use()</code> both the <code>stats()</code> and <code>repl()</code> plugins.</p>

<pre><code>  cluster(server)
    .use(cluster.stats())
    .use(cluster.repl(8888))
    .listen(3000);
</code></pre>

<p>Telnet to the repl:</p>

<pre><code>  $ telnet localhost 8888
</code></pre>

<h3>stats()</h3>

<p> After manually killing two workers, the stats below show information regarding system load average, uptime, total workers spawned, deaths, worker-specific stats and more.</p>

<pre><code>cluster&gt; stats()

  Master
  os: Darwin 10.5.0
  state: active
  started: Fri, 11 Feb 2011 16:58:48 GMT
  uptime: 2 minutes
  workers: 4
  deaths: 2

  Resources
  load average: 0.35 0.23 0.15
  cores utilized: 4 / 4
  memory at boot (free / total): 2.18gb / 4.00gb
  memory now (free / total): 2.08gb / 4.00gb

  Workers
  0: 2 minutes
  1: 2 minutes
  2: 1 minute
  3: 22 seconds
</code></pre>

<h3>Options</h3>

<ul>
<li><code>connections</code>  enable connection statistics</li>
<li><code>requests</code>     enable request statistics</li>
</ul>


<h3>Connection Statistics</h3>

<p>  Cluster can report on connections made to the server in each worker. To utilize simply pass <code>{ connections: true }</code>, and then view the stats in the REPL. You will now see the total number of connections made, and the total active connections, along with a break-down of connections per-worker, leading the pipe is the active, trailing the pipe is the total number of connections.</p>

<pre><code>  Workers
  connections total: 60
  connections active: 0
  0: 15 seconds 0|4
  1: 15 seconds 0|1
  2: 15 seconds 0|25
  3: 15 seconds 0|30
</code></pre>

<h3>Request Statistics</h3>

<p>  Cluster supports reporting on requests as well, currently only tallying up the total number, however is capable of much more. The REPL <code>stats()</code> output below is the result of passing <code>.use(cluster.stats({ connections: true, requests: true }))</code>.</p>

<pre><code>  Workers
  connections total: 60
  connections active: 0
  requests total: 24064
  0: 15 seconds 0|4|3358
  1: 15 seconds 0|1|1126
  2: 15 seconds 0|25|9613
  3: 15 seconds 0|30|9967
</code></pre>

<h3>Events</h3>

<p>  When the options shown above are used, events are also emitted, so even if you do not plan on using the REPL, these events may be helpful to other plugins.</p>

<ul>
<li><code>client connection</code>, worker</li>
<li><code>client disconnection</code>, worker</li>
<li><code>client request</code>, worker, request</li>
</ul>

    </div>
  </body>
</html>